<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post Lost Item - CampusLost</title>
    <style>
        body{font-family:Inter,system-ui;padding:2rem;background:#f3f6fb}
        .card{max-width:480px;margin:0 auto;padding:1.25rem;background:white;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.06)}
        input,button,select,textarea{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #ddd}
        button{cursor:pointer;background:#004080;color:#fff;border:none}

        /* Professional Toast Notifications */
        .toast-container {
          position: fixed;
          top: 20px;
          right: 20px;
          z-index: 1000;
        }

        .toast {
          background: white;
          padding: 1rem 1.5rem;
          margin-bottom: 0.5rem;
          border-radius: 8px;
          box-shadow: 0 4px 20px rgba(0,0,0,0.15);
          border-left: 4px solid;
          min-width: 300px;
          transform: translateX(400px);
          opacity: 0;
          transition: all 0.3s ease;
        }

        .toast.show {
          transform: translateX(0);
          opacity: 1;
        }

        .toast.success {
          border-left-color: #28a745;
          background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        }

        .toast.error {
          border-left-color: #dc3545;
          background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        }

        .toast-header {
          font-weight: 600;
          margin-bottom: 0.5rem;
        }

        .toast-body {
          color: #666;
          font-size: 0.9rem;
        }
      </style>
</head>
<body>
    <div class="card">
        <h2>Post Lost Item</h2>
        <input id="title" placeholder="Item Title (e.g., iPhone 13, Student ID, Laptop)" required />
        <textarea id="description" placeholder="Detailed description of the item..." rows="4"></textarea>
        <select id="category" required>
          <option value="">Select Category</option>
          <option value="Electronics">Electronics</option>
          <option value="Documents">Documents</option>
          <option value="Clothing">Clothing</option>
          <option value="Accessories">Accessories</option>
          <option value="Others">Others</option>
        </select>
        <input id="location" placeholder="Where did you lose it? (e.g., Library, Cafeteria)" required />
        <input id="contactInfo" placeholder="Additional contact info (optional)" />
        <button onclick="postLost()">Post Lost Item</button>
        <p id="msg" style="color:green"></p>
    </div>

    <div class="toast-container" id="toastContainer"></div>

    <script>
        const API_BASE = 'http://localhost:8081';

        // Helper function to get auth token
        function getAuthToken() {
          return localStorage.getItem('authToken');
        }

        // Helper function to check if user is authenticated
        function isAuthenticated() {
          return !!getAuthToken();
        }

        async function postLost() {
          const title = document.getElementById('title').value.trim();
          const description = document.getElementById('description').value.trim();
          const category = document.getElementById('category').value;
          const location = document.getElementById('location').value.trim();
          const contactInfo = document.getElementById('contactInfo').value.trim();

          if (!title || !description || !category || !location) {
            showToast('Please fill in all required fields!', 'error');
            return;
          }

          // Check if user is authenticated
          if (!isAuthenticated()) {
              showToast('Please login first to post items!', 'error');
              return;
            }

          const itemData = {
            title: title,
            description: description,
            category: category,
            status: 'LOST',
            location: location,
            contactInfo: contactInfo || 'Contact through platform'
          };

          try {
            const authToken = getAuthToken();
            const response = await fetch(`${API_BASE}/api/items`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`  // Bearer prefix added here
              },
              body: JSON.stringify(itemData)
            });

            if (response.ok) {
              showToast('Lost item posted successfully! Others can now help find it.', 'success');

              // Clear form
              document.getElementById('title').value = '';
              document.getElementById('description').value = '';
              document.getElementById('category').selectedIndex = 0;
              document.getElementById('location').value = '';
              document.getElementById('contactInfo').value = '';
            } else {
              const error = await response.text();
              showToast('Failed to post item: ' + error, 'error');
            }
          } catch (error) {
            console.error('Error posting lost item:', error);
            showToast('Network error. Please try again.', 'error');
          }
        }

        function showToast(message, type) {
          const toastContainer = document.getElementById('toastContainer');
          const toast = document.createElement('div');
          toast.className = `toast ${type} show`;
          toast.innerHTML = `
            <div class="toast-header">${type === 'success' ? 'Success' : 'Error'}</div>
            <div class="toast-body">${message}</div>
          `;
          toastContainer.appendChild(toast);

          // Auto-remove toast after 5 seconds
          setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => {
              toastContainer.removeChild(toast);
            }, 300);
          }, 5000);
        }

        // Check authentication on page load
        window.addEventListener('DOMContentLoaded', function() {
          if (!isAuthenticated()) {
              document.getElementById('msg').innerHTML = 'Please <a href="auth.html">login</a> first to post items!';
              document.getElementById('msg').style.color = 'orange';
            }
        });
      </script>
</body>
</html>
