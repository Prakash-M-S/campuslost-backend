<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report Found Item - CampusLost</title>
    <style>
        body{font-family:Inter,system-ui;padding:2rem;background:#f7fbff}
        .card{max-width:520px;margin:0 auto;padding:1.25rem;background:white;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.06)}
        input,button,textarea{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #ddd}
        button{cursor:pointer;background:#0060c0;color:#fff;border:none}
        .result{background:#eef6ff;padding:10px;border-radius:8px;margin-top:10px}

        /* Professional Toast Notifications */
        .toast-container {
          position: fixed;
          top: 20px;
          right: 20px;
          z-index: 1000;
        }

        .toast {
          background: white;
          padding: 1rem 1.5rem;
          margin-bottom: 0.5rem;
          border-radius: 8px;
          box-shadow: 0 4px 20px rgba(0,0,0,0.15);
          border-left: 4px solid;
          min-width: 300px;
          transform: translateX(400px);
          opacity: 0;
          transition: all 0.3s ease;
        }

        .toast.show {
          transform: translateX(0);
          opacity: 1;
        }

        .toast.success {
          border-left-color: #28a745;
          background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        }

        .toast.error {
          border-left-color: #dc3545;
          background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        }

        .toast-header {
          font-weight: 600;
          margin-bottom: 0.5rem;
        }

        .toast-body {
          color: #666;
          font-size: 0.9rem;
        }
      </style>
</head>
<body>
  <div class="card">
    <h2>Report Found Item</h2>
    <input id="title" placeholder="Item Title (e.g., iPhone 13, Student ID, Laptop)" required />
    <textarea id="description" placeholder="Detailed description of the item..." rows="4"></textarea>
    <select id="category" required>
      <option value="">Select Category</option>
      <option value="Electronics">Electronics</option>
      <option value="Documents">Documents</option>
      <option value="Clothing">Clothing</option>
      <option value="Accessories">Accessories</option>
      <option value="Others">Others</option>
    </select>
    <input id="location" placeholder="Where did you find it? (e.g., Library, Cafeteria)" required />
    <input id="contactInfo" placeholder="Additional contact info (optional)" />
    <button onclick="reportFound()">Report Found Item</button>

    <div id="output"></div>
  </div>

  <script>
    const API_BASE = 'http://localhost:8081';

    // Helper function to get auth token
    function getAuthToken() {
      return localStorage.getItem('authToken');
    }

    // Helper function to check if user is authenticated
    function isAuthenticated() {
      return !!getAuthToken();
    }

    async function reportFound() {
      const title = document.getElementById('title').value.trim();
      const description = document.getElementById('description').value.trim();
      const category = document.getElementById('category').value;
      const location = document.getElementById('location').value.trim();
      const contactInfo = document.getElementById('contactInfo').value.trim();

      if (!title || !description || !category || !location) {
        document.getElementById('output').innerHTML = '<div style="color:red;">Please fill in all required fields!</div>';
        return;
      }

      // Check if user is authenticated
      if (!isAuthenticated()) {
        document.getElementById('output').innerHTML = '<div style="color:red;">Please <a href="index.html">login</a> first to report found items!</div>';
        return;
      }

      const itemData = {
        title,
        description,
        category,
        status: 'FOUND',
        location,
        contactInfo: contactInfo || 'Contact through platform'
      };

      try {
        const authToken = getAuthToken();
        const response = await fetch(`${API_BASE}/api/items`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`
          },
          body: JSON.stringify(itemData)
        });

        if (response.ok) {
          const newItem = await response.json();

          // Try to find matching lost items
          const matchResponse = await fetch(`${API_BASE}/api/items/filter?status=LOST&keyword=${title}`, {
            headers: authToken ? { 'Authorization': `Bearer ${authToken}` } : {}
          });

          let matchHtml = '<div class="result" style="background:#d4edda;color:#155724;"><strong>Found item reported successfully!</strong></div>';

          if (matchResponse.ok) {
            const matches = await matchResponse.json();
            if (matches.length > 0) {
              matchHtml += '<div class="result"><strong>ðŸŽ¯ Potential matches found:</strong><br>';
              matches.forEach(match => {
                matchHtml += `â€¢ ${match.title} - ${match.description}<br>`;
              });
              matchHtml += 'Contact the item owners through the platform!</div>';
            } else {
              matchHtml += '<div class="result">No immediate matches found, but the item is now listed for owners to find.</div>';
            }
          }

          document.getElementById('output').innerHTML = matchHtml;

          // Clear form
          document.getElementById('title').value = '';
          document.getElementById('description').value = '';
          document.getElementById('category').value = '';
          document.getElementById('location').value = '';
          document.getElementById('contactInfo').value = '';

        } else {
          const error = await response.text();
          document.getElementById('output').innerHTML = `<div style="color:red;">Failed to report item: ${error}</div>`;
        }
      } catch (error) {
        console.error('Error reporting found item:', error);
        document.getElementById('output').innerHTML = '<div style="color:red;">Network error. Please try again.</div>';
      }
    }

    // Check authentication on page load
    window.addEventListener('DOMContentLoaded', function() {
      if (!isAuthenticated()) {
        document.getElementById('output').innerHTML = '<div style="color:orange;">Please <a href="index.html">login</a> first to report found items!</div>';
      }
    });
  </script>
</body>
</html>
